{% extends "base.html" %}
{% load static %}

{% block body %}

<style>
.cart-page {
  max-width: 1200px;
  margin: 40px auto;
  padding: 0 30px;
  font-family: Inter, sans-serif;
}

.cart-title {
  font-size: 26px;
  margin-bottom: 30px;
}

/* LAYOUT */
.cart-layout {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 40px;
}

/* LEFT CART */
.cart-items {
  border: 1px solid #211b1bc7;
  border-radius: 16px;
  padding: 25px;
  background: #fff;
}

.cart-head {
  display: grid;
  grid-template-columns: 1fr 140px 140px 60px;
  font-size: 12px;
  opacity: 0.65;
  padding-bottom: 18px;
  border-bottom: 1px solid #38363698;
}

.cart-item {
  display: grid;
  grid-template-columns: 1fr 140px 140px 60px;
  align-items: center;
  padding: 22px 0;
  border-bottom: 1px solid #38363698;
}
.cart-item > div:nth-child(2) {
  display: flex;
  justify-content: center;
}

.cart-item:last-child {
  border-bottom: none;
}

.cart-product {
  display: flex;
  gap: 15px;
  align-items: center;
}

.cart-product img {
  width: 72px;
  height: 72px;
  object-fit: cover;
  border-radius: 10px;
}

.cart-product h4 {
  font-size: 13px;
  margin: 0;
}

.cart-product p {
  font-size: 11px;
  opacity: 0.6;
  margin: 2px 0 0;
}
.cart-item > div:nth-child(2) {
  display: flex;
  justify-content: center;
}

/* QTY */
.qty-box {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  border: 1px solid #d0d0d0;
  border-radius: 999px;
  height: 26px;
  min-width: 86px;
  margin-right:85px ;
}

.qty-box button {
  border: none;
  background: none;
  font-size: 13px;
  cursor: pointer;
  line-height: 1;
}

.qty-box span {
  font-size: 12px;
  width: 18px;
  text-align: center;
}




/* PRICE */
.item-total {
  font-size: 13px;
}

/* REMOVE */
.remove {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 16px;
}

/* RIGHT SUMMARY */
.order-summary {
  border: 1px solid #211b1bc7;
  border-radius: 16px;
  padding: 28px;
  background: #fff;
}

.order-summary h3 {
  font-size: 16px;
  margin-bottom: 22px;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  margin-bottom: 14px;
}

.summary-row.total {
  font-weight: 600;
  margin-top: 18px;
  padding-top: 16px;
  border-top: 1px solid #2d2c2c96;
}

/* CHECKOUT */
.checkout-btn {
  width: 100%;
  padding: 15px;
  margin-top: 24px;
  border-radius: 30px;
  border: 1px solid #0000006e;
  background: #fff;
  color: #000;
  font-size: 12px;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.25s ease;
}

.checkout-btn i {
  margin-right: 8px;
}

.checkout-btn:hover {
  background: #000;
  color: #fff;
}

/* FLOATING SOCIAL */
.floating-social {
  position: fixed;
  bottom: 30px;
  right: 30px;
  display: flex;
  gap: 18px;
  z-index: 1000;
}

.floating-social i {
  font-size: 18px;
  cursor: pointer;
  opacity: 0.8;
  transition: opacity 0.2s ease;
}

.floating-social i:hover {
  opacity: 1;
}

/* RESPONSIVE */
@media(max-width: 900px){
  .cart-layout {
    grid-template-columns: 1fr;
  }
}
/* EMPTY CART */
.cart-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* MAIN ALIGNMENT */
.empty-cart {
  min-height: calc(100vh - 90px); /* navbar height */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}

/* IMAGE */
.empty-cart img {
  width: 380px;
  max-width: 90%;
  margin-bottom: 24px;
}

/* TITLE */
.empty-cart h2 {
  font-size: 20px;
  margin-top:-14px;
  margin-bottom: 2px;
  letter-spacing: 0.6px;
}

/* TEXT */
.empty-cart p {
  font-size: 13px;
  opacity: 0.6;
  margin-bottom: 8px;
  line-height: 1.6;
}

/* BUTTON */
.empty-cart a {
  display: inline-block;
  padding: 14px 40px;
  background: #fff;
  color: #000;
  text-decoration: none;
  font-size: 12px;
  letter-spacing: 1px;
  border: 1px solid #000;
  transition: all 0.25s ease;
}


.empty-cart a:hover {
  background: #000;
  color: #fff;
}

</style>

<section class="cart-page">
{% if cart.item_count == 0 %}

  <!-- EMPTY CART -->
  <div class="empty-cart">
    <img src="{% static 'image/download.jpg' %}" alt="Empty cart">
    <h2>YOUR BAG IS EMPTY.</h2>
    <p>Bag items are saved for later after 60 minutes.<br>
       Haven’t added anything yet? Get shopping!</p>
    <a href="/shop">START SHOPPING</a>
  </div>

{% else %}

  <h1 class="cart-title">Shopping Cart</h1>

  <div class="cart-layout">

    <!-- LEFT CART -->
    <div class="cart-items">

      <div class="cart-head">
        <div>Product</div>
        <div>Quantity</div>
        <div>Total</div>
        <div></div>
      </div>

      {% for item in cart %}
      <div class="cart-item">

        <div class="cart-product">
          <img src="{{ item.product.image1.url }}" alt="">
          <div>
            <h4>{{ item.product.name }}</h4>
            <p>Colour: {{ item.product.color|default:"Default" }}</p>
          </div>
        </div>

        <div class="qty-box">
  <button class="qty-btn" data-action="decrease" data-id="{{ item.product.id }}">−</button>
  <span id="qty-{{ item.product.id }}">{{ item.quantity }}</span>
  <button class="qty-btn" data-action="increase" data-id="{{ item.product.id }}">+</button>
</div>



        <div class="item-total" id="total-{{ item.product.id }}">
  ₹{{ item.total_price }}
</div>



        <button class="remove delete-item" data-id="{{ item.product.id }}">
  <i class="bi bi-trash"></i>
</button>

      </div>
      {% empty %}
      <p>Your cart is empty.</p>
      {% endfor %}

    </div>

    <!-- RIGHT SUMMARY -->
    <div class="order-summary">

      <h3>Order Summary</h3>

      <div class="summary-row">
        <span>Subtotal</span>
        <span>₹{{ cart.get_total_price }}</span>
      </div>

      <div class="summary-row">
        <span>Delivery</span>
        <span>250</span>
      </div>

      <div class="summary-row total">
        <span>Total</span>
        <span id="cart-total">₹{{ cart.get_total_price|add:250}}</span>

      </div>

     <button class="checkout-btn" onclick="checkoutWhatsApp()">
   Checkout Now<i class="bi bi-whatsapp"></i>
</button>


    </div>

  </div>
  
{% endif %}
</section>

<!-- FLOATING SOCIAL ICONS -->
<div class="floating-social">
  <i class="bi bi-instagram"></i>
  <i class="bi bi-facebook"></i>
  <i class="bi bi-twitter"></i>
</div>

{% comment %} ###update/delete section {% endcomment %}
<script>


// UPDATE QTY
document.querySelectorAll('.qty-btn').forEach(btn => {
  btn.addEventListener('click', function () {
    const id = this.dataset.id;
    const action = this.dataset.action;

    const qtyEl = document.getElementById(`qty-${id}`);
    let qty = parseInt(qtyEl.innerText);

    qty = action === "increase" ? qty + 1 : qty - 1;
    if (qty < 1) return;

    fetch("{% url 'cart_update' %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": window.CSRF_TOKEN,
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: `product_id=${id}&quantity=${qty}`
    })
    .then(res => res.json())
    .then(data => {
      qtyEl.innerText = qty;
      document.getElementById(`total-${id}`).innerText = "₹" + data.item_total;
      document.getElementById("cart-total").innerText = "₹" + (data.cart_total + 250);
    });
  });
});

// DELETE ITEM
document.querySelectorAll('.delete-item').forEach(btn => {
  btn.addEventListener('click', function () {
    const id = this.dataset.id;

    fetch("{% url 'cart_delete' %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": window.CSRF_TOKEN,
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: `action=delete&product_id=${id}`
    })
    .then(res => res.json())
    .then(() => location.reload());
  });
});
</script>


<script>
window.checkoutWhatsApp = function () {
    let msg = "♛ *Friday Originals Order*\n\n";

    {% for item in cart %}
    msg += "• {{ item.product.name }} × {{ item.quantity }} ( {% widthratio item.quantity 1 3 %} pieces  ) = ₹{{ item.total_price }}\n";
    {% endfor %}

    msg += "\n• Delivery: ₹250\n";
    msg += "────────────────────\n\n";
    msg += "» *Total: ₹{{ cart.get_total_price|add:250 }}*";

    const encodedMsg = encodeURIComponent(msg);
    window.open("https://wa.me/917900010432?text=" + encodedMsg, "_blank");
};
</script>



{% endblock body %}
